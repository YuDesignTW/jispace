# 優惠券功能設定說明

## 概述
本說明文件詳細介紹如何在 JI Space 民宿訂房系統中設置和管理優惠券功能。

## 1. Google Sheets 設置

### 1.1 創建 Coupons 工作表
在您的 Google Sheets 中新增一個名為 `Coupons` 的工作表，並設置以下欄位：

| 欄位名稱 | 說明 | 範例 |
|---------|------|------|
| coupon code | 優惠券代碼 | TEST2025 |
| start day | 開始日期 (可為空) | 2025-01-31 |
| end day | 結束日期 (可為空) | 2025-12-31 |
| active | 是否啟用 (Y/N) | Y |
| discount type | 折扣類型 (% 或 $) | % |
| discount value | 折扣數值 | 20 |

### 1.2 欄位說明

**coupon code (必填)**
- 優惠券的唯一識別碼
- 建議使用英文字母和數字組合
- 不區分大小寫

**start day (選填)**
- 優惠券開始生效日期
- 格式：YYYY-MM-DD (例如：2025-01-31)
- 留空表示立即生效

**end day (選填)**
- 優惠券結束日期
- 格式：YYYY-MM-DD (例如：2025-12-31)
- 留空表示永久有效

**active (必填)**
- Y：啟用狀態
- N：停用狀態（即使在有效期內也無法使用）
- 預設值：Y

**discount type (必填)**
- `%`：百分比折扣（例如：20 代表 20% off）
- `$`：固定金額折扣（例如：500 代表減免 NT$500）

**discount value (必填)**
- 當 discount type 為 `%` 時：輸入百分比數字（例如：20 代表 20% 折扣）
- 當 discount type 為 `$` 時：輸入金額數字（例如：500 代表減免 NT$500）

### 1.3 範例資料

```
coupon code | start day  | end day    | active | discount type | discount value
------------|------------|------------|--------|---------------|---------------
TEST2025    | 2025-01-31 |            | Y      | %             | 20
WELCOME500  |            | 2025-06-30 | Y      | $             | 500
SUMMER20    | 2025-06-01 | 2025-08-31 | Y      | %             | 15
DISABLED    | 2025-01-01 | 2025-12-31 | N      | %             | 10
```

### 1.4 更新 Bookings 工作表
在 `Bookings` 工作表的最後新增一個 `coupon` 欄位，用於記錄使用的優惠券代碼。

## 2. 功能特色

### 2.1 優惠券驗證
- 即時驗證優惠券有效性
- 檢查優惠券是否存在
- 檢查啟用狀態
- 檢查有效期限

### 2.2 價格計算
- 自動計算折扣金額
- 百分比折扣：原價 × (折扣百分比 / 100)
- 固定金額折扣：直接減免指定金額
- 折扣後價格不會低於 NT$0

### 2.3 用戶體驗
- 優惠券輸入框和驗證按鈕
- 即時反饋驗證結果
- 價格明細顯示（原價、折扣、最終價格）
- 預訂摘要中顯示已套用的優惠券

## 3. 使用流程

### 3.1 客戶使用步驟
1. 在第三步「客人資訊」頁面找到優惠券輸入區塊
2. 輸入優惠券代碼
3. 點擊「驗證」按鈕
4. 系統顯示驗證結果：
   - 成功：顯示折扣信息，價格自動更新
   - 失敗：顯示錯誤訊息

### 3.2 管理員管理步驟
1. 開啟 Google Sheets
2. 進入 `Coupons` 工作表
3. 新增或編輯優惠券資料
4. 設定適當的有效期和折扣
5. 將 `active` 設為 `Y` 啟用優惠券

## 4. 錯誤訊息說明

| 錯誤訊息 | 原因 | 解決方法 |
|---------|------|---------|
| 請輸入優惠券代碼 | 未輸入代碼 | 輸入有效的優惠券代碼 |
| 無效的優惠券代碼 | 代碼不存在 | 檢查代碼是否正確 |
| 此優惠券已停用 | active 設為 N | 將 active 改為 Y |
| 此優惠券尚未生效 | 當前日期早於 start day | 等待生效日期或修改開始日期 |
| 此優惠券已過期 | 當前日期晚於 end day | 延長有效期或使用其他優惠券 |

## 5. 注意事項

### 5.1 安全性
- 優惠券代碼不區分大小寫
- 建議使用複雜的代碼避免被猜測
- 定期檢查和清理過期優惠券

### 5.2 技術限制
- 每筆訂單只能使用一張優惠券
- 折扣計算會四捨五入到整數
- 優惠券驗證需要網路連接

### 5.3 最佳實踐
- 定期備份 Google Sheets 資料
- 設定合理的有效期限
- 監控優惠券使用情況
- 及時關閉濫用的優惠券

## 6. 疑難排解

### 6.1 優惠券無法驗證
- 檢查網路連線
- 確認 Google Sheets 權限設定
- 檢查 API 端點是否正常

### 6.2 價格計算錯誤
- 檢查 discount type 和 discount value 設定
- 確認數值格式正確
- 重新整理頁面重試

### 6.3 訂單記錄問題
- 確認 Bookings 表有 coupon 欄位
- 檢查欄位名稱是否正確

## 7. 更新記錄

- 2025-01-31：初版發布，包含基本優惠券功能
- 支援百分比和固定金額折扣
- 支援有效期管理
- 支援啟用/停用控制

## 聯絡支援

如有技術問題，請聯絡：
- 電話：0901255029  
- 信箱：jispace.tw@gmail.com 